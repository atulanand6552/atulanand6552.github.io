<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>JSON Formatter – Single File</title>
  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827;
      --muted: #1f2937;
      --text: #e5e7eb;
      --text-dim: #9ca3af;
      --accent: #22d3ee;
      --accent-2: #60a5fa;
      --good: #34d399;
      --bad: #f87171;
      --border: #334155;
      --shadow: 0 10px 25px rgba(0,0,0,.35);
      --radius: 16px;
    }
    * { box-sizing: border-box }
    html, body { height: 100% }
    body {
      margin: 0; background: linear-gradient(180deg, #0b1220, var(--bg));
      color: var(--text); font: 14px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    .wrap { max-width: 1200px; margin: 0 auto; padding: 20px; }
    header { display:flex; gap:16px; align-items:end; justify-content:space-between; flex-wrap:wrap; }
    h1 { font-size: 22px; letter-spacing: .2px; margin: 0; }
    h1 span { background: linear-gradient(90deg, var(--accent), var(--accent-2)); -webkit-background-clip: text; background-clip: text; color: transparent; }
    .toolbar { display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
    .panel { background: var(--panel); border:1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow); }
    .grid { display:grid; grid-template-columns: 1fr 1fr; gap: 14px; margin-top:14px; }
    @media (max-width: 900px){ .grid { grid-template-columns: 1fr; } }
    .col { display:flex; flex-direction:column; min-height: 360px; }
    label { font-size:12px; color: var(--text-dim); margin: 10px 12px 6px; }
    textarea, pre {
      flex:1; width:100%; border:0; color:var(--text); background: transparent; resize: vertical;
      padding: 14px; border-radius: calc(var(--radius) - 4px);
      font: 12.5px/1.45 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      outline: none;
    }
    pre { margin: 0; white-space: pre-wrap; word-break: break-word; background: #0b1220; border-top:1px dashed var(--border); }
    .buttons { display:flex; gap:8px; flex-wrap:wrap; padding: 10px; border-top:1px solid var(--border); }
    button, select { background: var(--muted); color: var(--text); border:1px solid var(--border); border-radius: 12px; padding: 8px 12px; cursor: pointer; transition: .15s ease; }
    button:hover, select:hover { border-color: #4b5563 }
    button.primary { background: linear-gradient(180deg, #1f6feb, #316dca); border-color: #3b82f6; }
    button.good { background: linear-gradient(180deg, #059669, #10b981); border-color: #10b981; }
    button.bad { background: linear-gradient(180deg, #b91c1c, #ef4444); border-color: #ef4444; }
    .switch { display:inline-flex; align-items:center; gap:8px; background: var(--muted); border:1px solid var(--border); border-radius: 999px; padding: 6px 10px; }
    .switch input { accent-color: var(--accent-2); }
    .note { color: var(--text-dim); font-size:12px; }
    .error { color: #fecaca; background: #450a0a; border-top:1px solid #7f1d1d; padding: 8px 12px; font-size:12.5px; }
    .row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .file { position: relative; overflow: hidden; }
    .file input { position:absolute; inset:0; opacity:0; cursor:pointer; }
    .kbd { font: 11px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace; background:#0b1220; border:1px solid var(--border); padding: 2px 6px; border-radius: 6px; }
    .hint { margin-top:8px; color: var(--text-dim); font-size:12px; }
    .footer { margin-top: 12px; color: var(--text-dim); font-size: 12px; text-align:center; }
    .toast { position: fixed; left: 50%; bottom: 18px; transform: translateX(-50%); background: #111827; border: 1px solid var(--border); padding: 8px 12px; border-radius: 999px; font-size: 12.5px; box-shadow: var(--shadow); }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>⚙️ <span>JSON Formatter</span> — Single HTML</h1>
        <div class="hint">Pretty‑print, minify, sort keys, validate, and export — no build step, no dependencies.</div>
      </div>
      <div class="toolbar row">
        <label class="row" title="Indentation spaces"><span class="note">Indent</span>
          <select id="indent">
            <option value="2">2</option>
            <option value="4">4</option>
          </select>
        </label>
        <label class="row" title="Sort object keys alphabetically">
          <span class="note">Sort keys</span>
          <select id="sort">
            <option value="none">Off</option>
            <option value="shallow">Shallow</option>
            <option value="deep" selected>Deep</option>
          </select>
        </label>
        <label class="switch" title="Format on input changes">
          <input type="checkbox" id="live" checked>
          <span>Live</span>
        </label>
      </div>
    </header>

    <div class="grid">
      <section class="panel col" aria-label="Input JSON">
        <label for="input">Input</label>
        <textarea id="input" spellcheck="false" placeholder='{"hello":"world"}'></textarea>
        <div id="inError" class="error" hidden></div>
        <div class="buttons">
          <div class="row">
            <button class="primary" id="formatBtn" title="Beautify (Ctrl/Cmd+B)">Beautify</button>
            <button id="minifyBtn" title="Minify (Ctrl/Cmd+M)">Minify</button>
            <button id="beautifySelBtn" title="Beautify only selected text">Beautify Selection</button>
          </div>
          <div class="row">
            <label class="file"><button>Upload JSON</button><input id="file" type="file" accept=".json,application/json,text/plain"></label>
            <button id="pasteBtn" title="Paste from clipboard">Paste</button>
            <button id="clearBtn" class="bad" title="Clear (Ctrl/Cmd+L)">Clear</button>
          </div>
        </div>
      </section>

      <section class="panel col" aria-label="Output JSON">
        <label for="output">Output</label>
        <pre id="output" aria-live="polite"></pre>
        <div id="outError" class="error" hidden></div>
        <div class="buttons">
          <div class="row">
            <button class="good" id="copyBtn" title="Copy formatted JSON">Copy</button>
            <button id="downloadBtn" title="Download as formatted.json (Ctrl/Cmd+S)">Download</button>
          </div>
          <span class="note">Characters: <span id="count">0</span></span>
        </div>
      </section>
    </div>

    <div class="footer">Shortcuts: <span class="kbd">Ctrl/Cmd+B</span> beautify • <span class="kbd">Ctrl/Cmd+M</span> minify • <span class="kbd">Ctrl/Cmd+L</span> clear • <span class="kbd">Ctrl/Cmd+S</span> download</div>
  </div>

  <script>
    const $ = (sel) => document.querySelector(sel);
    const inputEl = $('#input');
    const outputEl = $('#output');
    const inErr = $('#inError');
    const outErr = $('#outError');
    const countEl = $('#count');

    const indentSel = $('#indent');
    const sortSel = $('#sort');
    const liveChk = $('#live');

    // Restore from localStorage
    const saved = localStorage.getItem('sf-json:input');
    inputEl.value = saved || defaultSample();

    function defaultSample(){
      return JSON.stringify({
        product: { id: 33, title: 'Mulberry', price: 19.99 },
        tags: ['fruit','fresh','seasonal'],
        meta: { created: new Date().toISOString(), inStock: true }
      }, null, 2);
    }

    function toast(msg){
      const t = document.createElement('div');
      t.className = 'toast';
      t.textContent = msg;
      document.body.appendChild(t);
      setTimeout(() => t.remove(), 1400);
    }

    function parseJSON(str){
      try { return [JSON.parse(str), null]; }
      catch(e){ return [null, e && e.message ? String(e.message) : 'Invalid JSON']; }
    }

    function sortObjectKeys(value, deep){
      if (Array.isArray(value)) return value.map(v => deep ? sortObjectKeys(v, true) : v);
      if (value && typeof value === 'object'){
        const entries = Object.entries(value).sort(([a],[b]) => a.localeCompare(b));
        const out = {};
        for (const [k,v] of entries) out[k] = deep ? sortObjectKeys(v, true) : v;
        return out;
      }
      return value;
    }

    function format(minify=false){
      const src = inputEl.value.trim();
      if (!src){ outputEl.textContent=''; setErrors(); updateCount(); return; }
      const [obj, err] = parseJSON(src);
      if (err){ setErrors(err); outputEl.textContent=''; updateCount(); return false; }
      let processed = obj;
      const sortMode = sortSel.value; // none | shallow | deep
      if (sortMode !== 'none'){
        processed = sortObjectKeys(obj, sortMode === 'deep');
      }
      const space = minify ? 0 : parseInt(indentSel.value, 10);
      outputEl.textContent = JSON.stringify(processed, null, space);
      setErrors();
      updateCount();
      return true;
    }

    function beautifySelection(){
      const ta = inputEl;
      const start = ta.selectionStart, end = ta.selectionEnd;
      if (start === end) return format(false);
      const sel = ta.value.slice(start, end);
      const [obj, err] = parseJSON(sel);
      if (err){ setErrors(err); return; }
      const sortMode = sortSel.value;
      const processed = sortMode==='none'? obj : sortObjectKeys(obj, sortMode==='deep');
      const pretty = JSON.stringify(processed, null, parseInt(indentSel.value,10));
      ta.setRangeText(pretty, start, end, 'select');
      setErrors();
      if (liveChk.checked) format(false);
    }

    function setErrors(inputMsg, outputMsg){
      if (inputMsg){ inErr.hidden = false; inErr.textContent = inputMsg; }
      else { inErr.hidden = true; inErr.textContent = ''; }
      if (outputMsg){ outErr.hidden = false; outErr.textContent = outputMsg; }
      else { outErr.hidden = true; outErr.textContent = ''; }
    }

    function updateCount(){ countEl.textContent = (outputEl.textContent || inputEl.value || '').length; }

    // Actions
    $('#formatBtn').addEventListener('click', () => format(false));
    $('#minifyBtn').addEventListener('click', () => format(true));
    $('#beautifySelBtn').addEventListener('click', beautifySelection);
    $('#clearBtn').addEventListener('click', () => { inputEl.value=''; outputEl.textContent=''; setErrors(); updateCount(); inputEl.focus(); save(); });
    $('#pasteBtn').addEventListener('click', async () => {
      try { const txt = await navigator.clipboard.readText(); if (txt){ inputEl.value = txt; changed(); } }
      catch { toast('Clipboard permission denied'); }
    });
    $('#file').addEventListener('change', (e) => {
      const file = e.target.files && e.target.files[0]; if (!file) return;
      const reader = new FileReader();
      reader.onload = () => { inputEl.value = String(reader.result || ''); changed(); };
      reader.readAsText(file);
      e.target.value = '';
    });
    $('#copyBtn').addEventListener('click', async () => {
      try { await navigator.clipboard.writeText(outputEl.textContent || inputEl.value || ''); toast('Copied'); }
      catch { toast('Copy failed'); }
    });
    $('#downloadBtn').addEventListener('click', () => {
      const blob = new Blob([outputEl.textContent || inputEl.value || ''], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'formatted.json';
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    });

    function save(){ localStorage.setItem('sf-json:input', inputEl.value); }
    function changed(){ save(); if (liveChk.checked) format(false); else updateCount(); }

    inputEl.addEventListener('input', changed);
    indentSel.addEventListener('change', () => liveChk.checked ? format(false) : void 0);
    sortSel.addEventListener('change', () => liveChk.checked ? format(false) : void 0);
    liveChk.addEventListener('change', () => liveChk.checked ? format(false) : void 0);

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      const mod = e.metaKey || e.ctrlKey;
      if (!mod) return;
      if (e.key.toLowerCase() === 'b'){ e.preventDefault(); format(false); }
      if (e.key.toLowerCase() === 'm'){ e.preventDefault(); format(true); }
      if (e.key.toLowerCase() === 'l'){ e.preventDefault(); inputEl.value=''; outputEl.textContent=''; setErrors(); updateCount(); save(); }
      if (e.key.toLowerCase() === 's'){ e.preventDefault(); $('#downloadBtn').click(); }
    });

    // Initial render
    format(false);
  </script>
</body>
</html>
